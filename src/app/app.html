<div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-100 to-gray-200">

  <div class="bg-white w-full max-w-md rounded-[2rem] shadow-card overflow-hidden fade-in">

    <div class="bg-movilizate-red p-8 text-center relative overflow-hidden">
      <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-white via-transparent to-transparent"></div>

      <h1 class="text-white text-3xl font-extrabold tracking-wider relative z-10">movilizate</h1>
      <p class="text-red-200 text-sm mt-2 relative z-10 font-medium">Sistema Integrado de Transporte</p>

      <div class="absolute top-6 right-6 opacity-80">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      </div>
    </div>

    <div *ngIf="step === 1" class="p-8 space-y-8 fade-in">

      <div>
        <label class="block text-movilizate-dark font-bold text-sm uppercase tracking-wide mb-3">ID de Tarjeta</label>
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="cardId"
            placeholder="Ej: CURA0010505920"
            class="input-inset w-full p-4 pl-5 text-lg font-mono border border-gray-200 rounded-xl focus:border-movilizate-red focus:ring-2 focus:ring-red-100 focus:outline-none transition-all uppercase text-movilizate-dark"
          >
          <span class="absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
            </svg>
          </span>
        </div>
        <p class="text-xs text-gray-500 mt-2 ml-1">Revisa el reverso de tu tarjeta (empieza con CURA)</p>
      </div>

      <div>
        <label class="block text-movilizate-dark font-bold text-sm uppercase tracking-wide mb-3">Monto a Recargar</label>

        <div class="grid grid-cols-3 gap-4 mb-4">
          <button (click)="selectAmount(2)" [class]="amount === 2 ? 'bg-movilizate-red text-white border-transparent shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:border-movilizate-red hover:bg-red-50'" class="p-3 border-2 rounded-xl font-bold transition-all duration-200 transform active:scale-95">$2.00</button>
          <button (click)="selectAmount(5)" [class]="amount === 5 ? 'bg-movilizate-red text-white border-transparent shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:border-movilizate-red hover:bg-red-50'" class="p-3 border-2 rounded-xl font-bold transition-all duration-200 transform active:scale-95">$5.00</button>
          <button (click)="selectAmount(10)" [class]="amount === 10 ? 'bg-movilizate-red text-white border-transparent shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:border-movilizate-red hover:bg-red-50'" class="p-3 border-2 rounded-xl font-bold transition-all duration-200 transform active:scale-95">$10.00</button>
        </div>

        <div class="relative">
          <span class="absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-700 font-bold text-lg pointer-events-none">$</span>
          <input
            type="number"
            [(ngModel)]="amount"
            placeholder="Otro valor..."
            class="input-inset w-full p-4 pl-10 text-lg font-bold border border-gray-200 rounded-xl focus:border-movilizate-red focus:ring-2 focus:ring-red-100 focus:outline-none transition-all text-movilizate-dark"
          >
        </div>
      </div>

      <button
        (click)="proceedToPayment()"
        class="w-full bg-movilizate-red text-white text-lg font-bold py-5 rounded-xl shadow-lg hover:bg-red-900 transition-all transform active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-red-200">
        CONTINUAR
      </button>
    </div>

    <div *ngIf="step === 2" class="p-8 fade-in">

      <button (click)="step = 1" class="text-gray-500 mb-6 flex items-center gap-2 hover:text-movilizate-red transition-colors font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
        Volver
      </button>

      <h2 class="text-xl font-extrabold text-movilizate-dark mb-8">Selecciona método de pago</h2>

      <div class="space-y-5" *ngIf="!selectedBank">
        <div (click)="selectBank('pichincha')" class="group cursor-pointer bg-white border-2 border-gray-100 p-5 rounded-2xl flex items-center gap-5 hover:border-yellow-400 hover:shadow-md transition-all transform active:scale-[0.98]">
          <div class="w-14 h-14 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-sm group-hover:scale-110 transition-transform">BP</div>
          <div>
            <p class="font-bold text-lg text-gray-800">Banco Pichincha</p>
            <p class="text-sm text-gray-500 font-medium">Banca Móvil / Deuna</p>
          </div>
          <div class="ml-auto text-gray-300 group-hover:text-yellow-400 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
          </div>
        </div>

        <div (click)="selectBank('jep')" class="group cursor-pointer bg-white border-2 border-gray-100 p-5 rounded-2xl flex items-center gap-5 hover:border-green-500 hover:shadow-md transition-all transform active:scale-[0.98]">
          <div class="w-14 h-14 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-sm group-hover:scale-110 transition-transform">JEP</div>
          <div>
            <p class="font-bold text-lg text-gray-800">Cooperativa JEP</p>
            <p class="text-sm text-gray-500 font-medium">JEPFast</p>
          </div>
          <div class="ml-auto text-gray-300 group-hover:text-green-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
          </div>
        </div>
      </div>

      <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-16 fade-in">
        <div class="animate-spin rounded-full h-14 w-14 border-4 border-gray-200 border-t-movilizate-red"></div>
        <p class="mt-6 text-movilizate-dark font-bold animate-pulse">Generando código QR...</p>
      </div>

      <div *ngIf="selectedBank && !isLoading" class="text-center fade-in">
        <div class="bg-white p-4 rounded-3xl shadow-inner border border-gray-100 inline-block mb-6">
          <div class="p-2 bg-white rounded-2xl border-2 border-dashed border-gray-300">
            <img [src]="'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=PagoMovilizate_' + cardId + '_' + amount" alt="QR Code" class="rounded-lg mix-blend-multiply">
          </div>
        </div>

        <div class="mb-6">
          <p class="text-sm text-gray-500 font-medium uppercase tracking-wider mb-1">Total a pagar</p>
          <p class="font-extrabold text-4xl text-movilizate-red">${{amount | number:'1.2-2'}}</p>
        </div>

        <div class="bg-gray-50 p-4 rounded-xl mb-6 text-sm text-gray-600">
          Escanea este código con tu app de <strong>{{selectedBank === 'pichincha' ? 'Banco Pichincha' : 'JEP'}}</strong> para completar la recarga.
        </div>

        <button (click)="reset()" class="w-full bg-gray-100 text-gray-700 font-bold py-4 rounded-xl hover:bg-gray-200 transition-colors focus:outline-none">
          Cancelar / Nueva Recarga
        </button>
      </div>

    </div>
  </div>

  <p class="fixed bottom-6 text-xs text-gray-500 font-medium opacity-70">© 2026 Consorcio SIR Cuenca - Prototipo con fines Académicos</p>
  <p class="fixed bottom-6 right-6 text-xs text-gray-500 font-medium opacity-70">DESIGN BY ATENAS GO</p>
</div>
